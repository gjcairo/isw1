Object subclass: #Address	instanceVariableNames: 'id streetName streetNumber town zipCode province'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-1-Model'!!Address methodsFor: 'zip code' stamp: 'HernanWilkinson 10/28/2016 16:13'!zipCode	^zipCode! !!Address methodsFor: 'twon' stamp: 'HernanWilkinson 10/28/2016 16:12'!town	^town! !!Address methodsFor: 'province' stamp: 'HernanWilkinson 10/28/2016 16:11'!province	^province! !!Address methodsFor: 'province' stamp: 'SebastianTaboh 11/9/2017 20:33'!initializeWithStreetName: aStreetName streetNumber: aStreetNumber town: aTownName zipCode: aZipCode province: aProvinceName	streetName := aStreetName.	streetNumber := aStreetNumber.	town := aTownName.	zipCode := aZipCode.	province := aProvinceName ! !!Address methodsFor: 'street' stamp: 'HernanWilkinson 10/28/2016 16:12'!streetName	^streetName ! !!Address methodsFor: 'street' stamp: 'HernanWilkinson 10/28/2016 16:12'!streetNumber	^streetNumber ! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Address class	instanceVariableNames: ''!!Address class methodsFor: 'instance creation' stamp: 'SebastianTaboh 11/9/2017 20:32'!newWithStreetName: aStreetName streetNumber: aStreetNumber town: aTownName zipCode: aZipCode province: aProvinceName	^ self new initializeWithStreetName: aStreetName streetNumber: aStreetNumber town: aTownName zipCode: aZipCode province: aProvinceName ! !Object subclass: #Customer	instanceVariableNames: 'id firstName lastName identificationType identificationNumber addresses'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-1-Model'!!Customer methodsFor: 'identification' stamp: 'GustavoJuanCairo 11/8/2017 00:25'!invalidAddressErrorMessage	^ 'La direccion no pertenece al cliente'! !!Customer methodsFor: 'identification' stamp: 'GustavoJuanCairo 11/8/2017 00:25'!addressAt: aStreetName at: aStreetNumber	^ self addresses 		detect: [ :address | address streetName = aStreetName and: [ address streetNumber = aStreetNumber ] ] 		ifNone: [ self error: self invalidAddressErrorMessage ].! !!Customer methodsFor: 'identification' stamp: 'HernanWilkinson 10/28/2016 16:13'!identificationNumber		^identificationNumber ! !!Customer methodsFor: 'identification' stamp: 'HernanWilkinson 10/28/2016 13:10'!identificationNumber: anIdentificationNumber 	identificationNumber := anIdentificationNumber! !!Customer methodsFor: 'identification' stamp: 'HernanWilkinson 10/28/2016 13:10'!identificationType: anIdentificationType 	identificationType := anIdentificationType! !!Customer methodsFor: 'identification' stamp: 'HernanWilkinson 10/28/2016 16:13'!identificationType		^identificationType ! !!Customer methodsFor: 'addresses' stamp: 'HernanWilkinson 10/28/2016 13:27'!addAddress: anAddress 	addresses add: anAddress ! !!Customer methodsFor: 'addresses' stamp: 'SebastianTaboh 11/9/2017 20:40'!initializeWithFirstName: aFirstName lastName: aLastName idType: anIdType idNumber: anIdNumber		super initialize.	addresses := OrderedCollection new.	firstName := aFirstName.	lastName := aLastName.	identificationNumber := anIdNumber.	identificationType := anIdType ! !!Customer methodsFor: 'addresses' stamp: 'HernanWilkinson 10/28/2016 13:25'!addresses	^ addresses! !!Customer methodsFor: 'name' stamp: 'HernanWilkinson 10/28/2016 13:09'!firstName: aName 	firstName := aName! !!Customer methodsFor: 'name' stamp: 'HernanWilkinson 10/28/2016 13:09'!lastName: aLastName 	lastName := aLastName! !!Customer methodsFor: 'name' stamp: 'HernanWilkinson 10/28/2016 16:15'!firstName		^firstName ! !!Customer methodsFor: 'name' stamp: 'HernanWilkinson 10/28/2016 16:15'!lastName	^lastName ! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Customer class	instanceVariableNames: 'test'!!Customer class methodsFor: 'importing' stamp: 'SebastianTaboh 11/6/2017 20:07'!importCustomers	"	self importCustomers	"	test importCustomers! !!Customer class methodsFor: 'importing' stamp: 'SebastianTaboh 11/9/2017 20:38'!newWithFirstName: aFirstName lastName: aLastName idType: anIdType idNumber: anIdNumber	^ self new initializeWithFirstName: aFirstName lastName: aLastName idType: anIdType idNumber: anIdNumber! !Object subclass: #CustomerImporter	instanceVariableNames: 'line inputStream session lastProcessedCustomer record'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-1-Model'!!CustomerImporter methodsFor: 'importing' stamp: 'SebastianTaboh 11/9/2017 20:11'!createRecordFromLine	record := line substrings: {$,}! !!CustomerImporter methodsFor: 'importing' stamp: 'SebastianTaboh 11/9/2017 20:22'!initializeWith: aSession	session := aSession! !!CustomerImporter methodsFor: 'importing' stamp: 'SebastianTaboh 11/9/2017 20:15'!processLine	self createRecordFromLine.	self parseRecord! !!CustomerImporter methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:25'!parseAddress	lastProcessedCustomer ifNil: [ self error: self addressWithoutCustomerErrorMessage ].	lastProcessedCustomer addAddress: self createAddressFromRecord! !!CustomerImporter methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:08'!invalidRecordDescriptorErrorMessage	^ 'El descriptor de registro es inexistente: los únicos válidos son A para direcciones y C para clientes'! !!CustomerImporter methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:25'!createAddressFromRecord	(record size = 6) ifFalse: [ self error: self invalidAddressRecordErrorMessage ].		^ Address		newWithStreetName: record second		streetNumber: record third asInteger		town: record fourth		zipCode: record fifth asInteger		province: record sixth! !!CustomerImporter methodsFor: 'importing' stamp: 'SebastianTaboh 11/9/2017 19:48'!hasLineToProcess	line := inputStream nextLine.	^ line notNil! !!CustomerImporter methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 22:57'!addressWithoutCustomerErrorMessage	^ 'La primer linea del input stream debe ser un cliente, no una direccion'! !!CustomerImporter methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:21'!invalidAddressRecordErrorMessage	^ 'El registro de dirección tiene una cantidad incorrecta de campos'! !!CustomerImporter methodsFor: 'importing' stamp: 'SebastianTaboh 11/9/2017 21:38'!isAddressRecord	^ (record at: 1) = 'A'! !!CustomerImporter methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:14'!parseRecord	self isCustomerRecord		ifTrue: [ ^ self parseCustomer ].	self isAddressRecord		ifTrue: [ ^ self parseAddress ].	self error: self invalidRecordDescriptorErrorMessage	! !!CustomerImporter methodsFor: 'importing' stamp: 'SebastianTaboh 11/9/2017 21:38'!isCustomerRecord	^ (record at: 1) = 'C'! !!CustomerImporter methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:21'!invalidCustomerRecordErrorMessage	^ 'El registro de cliente tiene una cantidad incorrecta de campos'! !!CustomerImporter methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:23'!parseCustomer	lastProcessedCustomer := self createCustomerFromRecord.	session persist: lastProcessedCustomer! !!CustomerImporter methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:25'!createCustomerFromRecord	(record size = 5) ifFalse: [ self error: self invalidCustomerRecordErrorMessage ].		^ Customer		newWithFirstName: record second		lastName: record third		idType: record fourth		idNumber: record fifth! !!CustomerImporter methodsFor: 'importing' stamp: 'SebastianTaboh 11/9/2017 20:22'!importFrom: anInputStream	inputStream := anInputStream.	[ self hasLineToProcess ] whileTrue:		[ self processLine ].	inputStream close! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!CustomerImporter class	instanceVariableNames: ''!!CustomerImporter class methodsFor: 'instance creation' stamp: 'SebastianTaboh 11/9/2017 20:21'!new: aSession	^ self new initializeWith: aSession! !TestCase subclass: #CustomerImporterTest	instanceVariableNames: 'inputStream session customerImporter'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-1-Model'!!CustomerImporterTest methodsFor: 'importing' stamp: 'SebastianTaboh 11/9/2017 20:52'!invalidTestDataNoCustomerOnFirstLine	^ 'A,San Martin,3322,Olivos,1636,BsAsA,Maipu,888,Florida,1122,Buenos AiresC,Juan,Perez,C,23-25666777-9A,Alem,1122,CABA,1001,CABA'! !!CustomerImporterTest methodsFor: 'importing' stamp: 'SebastianTaboh 11/9/2017 20:20'!importCustomersTo: aSession from: anInputStream	customerImporter importFrom: anInputStream! !!CustomerImporterTest methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:04'!invalidTestDataDescriptorCFollowedByMoreLetters	^ 'CC,Pepe,Sanchez,D,22333444A,San Martin,3322,Olivos,1636,BsAsA,Maipu,888,Florida,1122,Buenos AiresC,Juan,Perez,C,23-25666777-9A,Alem,1122,CABA,1001,CABA'! !!CustomerImporterTest methodsFor: 'importing' stamp: 'SebastianTaboh 11/9/2017 20:50'!validTestData	^ 'C,Pepe,Sanchez,D,22333444A,San Martin,3322,Olivos,1636,BsAsA,Maipu,888,Florida,1122,Buenos AiresC,Juan,Perez,C,23-25666777-9A,Alem,1122,CABA,1001,CABA'! !!CustomerImporterTest methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:09'!invalidTestDataCustomerRecordWithMoreThanFiveFields	^ 'C,Pepe,Sanchez,D,22333444,BlaA,San Martin,3322,Olivos,1636,BsAsA,Maipu,888,Florida,1122,Buenos AiresC,Juan,Perez,C,23-25666777-9A,Alem,1122,CABA,1001,CABA'! !!CustomerImporterTest methodsFor: 'importing' stamp: 'SebastianTaboh 11/9/2017 20:49'!setUp	session := DataBaseSession		for:			(Array				with:					(ClassMapping						withDefaultTableNameFor: Address						mappingAll:							(Array								with: (EmbededMapping withDefaultFieldNameFor: #streetName)								with: (EmbededMapping withDefaultFieldNameFor: #streetNumber)								with: (EmbededMapping withDefaultFieldNameFor: #town)								with: (EmbededMapping withDefaultFieldNameFor: #zipCode)								with: (EmbededMapping withDefaultFieldNameFor: #province)))				with:					(ClassMapping						withDefaultTableNameFor: Customer						mappingAll:							(Array								with: (EmbededMapping withDefaultFieldNameFor: #firstName)								with: (EmbededMapping withDefaultFieldNameFor: #lastName)								with: (EmbededMapping withDefaultFieldNameFor: #identificationType)								with: (EmbededMapping withDefaultFieldNameFor: #identificationNumber)								with: (OneToManyMapping withDefaultFieldNameFor: #addresses ofType: Address)))).	session open.	session beginTransaction.	customerImporter := CustomerImporter new: session.! !!CustomerImporterTest methodsFor: 'importing' stamp: 'SebastianTaboh 11/6/2017 20:13'!tearDown	session commit.	session close! !!CustomerImporterTest methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:15'!invalidTestDataNonexistentLineDescriptor	^ 'J,Pepe,Sanchez,D,22333444A,San Martin,3322,Olivos,1636,BsAsA,Maipu,888,Florida,1122,Buenos AiresC,Juan,Perez,C,23-25666777-9A,Alem,1122,CABA,1001,CABA'! !!CustomerImporterTest methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:04'!invalidTestDataDescriptorAFollowedByMoreLetters	^ 'C,Pepe,Sanchez,D,22333444AA,San Martin,3322,Olivos,1636,BsAsA,Maipu,888,Florida,1122,Buenos AiresC,Juan,Perez,C,23-25666777-9A,Alem,1122,CABA,1001,CABA'! !!CustomerImporterTest methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:08'!invalidTestDataCustomerRecordWithLessThanFiveFields	^ 'C,Pepe,Sanchez,DA,San Martin,3322,Olivos,1636,BsAsA,Maipu,888,Florida,1122,Buenos AiresC,Juan,Perez,C,23-25666777-9A,Alem,1122,CABA,1001,CABA'! !!CustomerImporterTest methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:08'!invalidTestDataAddressRecordWithMoreThanSixFields	^ 'C,Pepe,Sanchez,D,22333444A,San Martin,3322,Olivos,1636,BsAs,BlaA,Maipu,888,Florida,1122,Buenos AiresC,Juan,Perez,C,23-25666777-9A,Alem,1122,CABA,1001,CABA'! !!CustomerImporterTest methodsFor: 'importing' stamp: 'GustavoJuanCairo 11/12/2017 23:08'!invalidTestDataAddressRecordWithLessThanSixFields	^ 'C,Pepe,Sanchez,D,22333444A,San Martin,3322,Olivos,1636A,Maipu,888,Florida,1122,Buenos AiresC,Juan,Perez,C,23-25666777-9A,Alem,1122,CABA,1001,CABA'! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/12/2017 23:17'!test04ImportingCustomersFromFileWithCLineDescriptorWithMoreCharactersFails	inputStream := ReadStream on: self invalidTestDataDescriptorCFollowedByMoreLetters.		self 		should: [ self importCustomersTo: session from: inputStream ] 		raise: Error - MessageNotUnderstood 		withExceptionDo: [ :anException |			anException messageText = (customerImporter invalidRecordDescriptorErrorMessage).			self assertCustomersNotImported ]! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/12/2017 23:19'!test05ImportingCustomersFromFileWithALineDescriptorWithMoreCharactersFails	inputStream := ReadStream on: self invalidTestDataDescriptorAFollowedByMoreLetters.		self 		should: [ self importCustomersTo: session from: inputStream ] 		raise: Error - MessageNotUnderstood 		withExceptionDo: [ :anException |			anException messageText = (customerImporter invalidRecordDescriptorErrorMessage).			self assert: (self numberOfCustomers) equals: 1 ]! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/8/2017 00:36'!assertJuanPerezImportedCorrectly	| customer idType idNumber anAddress |		idType := 'C'.	idNumber := '23-25666777-9'.	customer := self customerIdentifiedAs: idNumber ofType: idType.		self assert: customer firstName equals: 'Juan'.	self assert: customer lastName equals: 'Perez'.	self assert: customer identificationType equals: idType.	self assert: customer identificationNumber equals: idNumber.	anAddress := customer addressAt: 'Alem' at: 1122.	self assert: anAddress streetName equals: 'Alem'.	self assert: anAddress streetNumber equals: 1122.	self assert: anAddress town equals: 'CABA'.	self assert: anAddress zipCode equals: 1001.	self assert: anAddress province equals: 'CABA'.	! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/8/2017 00:16'!customerIdentifiedAs: idNumber ofType: idType	^ (session		select: [ :c | 			c identificationType = idType				and: [ c identificationNumber = idNumber ] ]		ofType: Customer) anyOne! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/12/2017 23:10'!assertCustomersNotImported	self assert: (self numberOfCustomers) equals: 0! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/12/2017 23:26'!test9CannotImportAddressRecordWithMoreThanSixFields	inputStream := ReadStream on: self invalidTestDataAddressRecordWithMoreThanSixFields.		self 		should: [ self importCustomersTo: session from: inputStream ] 		raise: Error - MessageNotUnderstood 		withExceptionDo: [ :anException |			anException messageText = (customerImporter invalidAddressRecordErrorMessage).			self assert: (self numberOfCustomers) equals: 1 ]! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/8/2017 00:33'!assertPepeSanchezImportedCorrectly	| customer idNumber idType anAddress |		idType := 'D'.	idNumber := '22333444'.	customer := self customerIdentifiedAs: idNumber ofType: idType.		self assert: customer firstName equals: 'Pepe'.	self assert: customer lastName equals: 'Sanchez'.	self assert: customer identificationType equals: idType.	self assert: customer identificationNumber equals: idNumber.		anAddress := customer addressAt: 'San Martin' at: 3322.	self assert: anAddress streetName equals: 'San Martin'.	self assert: anAddress streetNumber equals: 3322.	self assert: anAddress town equals: 'Olivos'.	self assert: anAddress zipCode equals: 1636.	self assert: anAddress province equals: 'BsAs'.		anAddress := customer addressAt: 'Maipu' at: 888.	self assert: anAddress streetName equals: 'Maipu'.	self assert: anAddress streetNumber equals: 888.	self assert: anAddress town equals: 'Florida'.	self assert: anAddress zipCode equals: 1122.	self assert: anAddress province equals: 'Buenos Aires'! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/12/2017 23:25'!test07CannotImportCustomerRecordWithMoreThanFiveFields	inputStream := ReadStream on: self invalidTestDataCustomerRecordWithMoreThanFiveFields.		self 		should: [ self importCustomersTo: session from: inputStream ] 		raise: Error - MessageNotUnderstood 		withExceptionDo: [ :anException |			anException messageText = (customerImporter invalidCustomerRecordErrorMessage).			self assertCustomersNotImported ]! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/12/2017 23:01'!numberOfCustomers	^ (session selectAllOfType: Customer) size! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/12/2017 23:01'!test01ImportCustomersMapsCustomersCorrectly	inputStream := ReadStream on: self validTestData.	self importCustomersTo: session from: inputStream.		self assert: self numberOfCustomers equals: 2.	self assertPepeSanchezImportedCorrectly.	self assertJuanPerezImportedCorrectly! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/12/2017 23:22'!test06CannotImportCustomerRecordWithLessThanFiveFields	inputStream := ReadStream on: self invalidTestDataCustomerRecordWithLessThanFiveFields.		self 		should: [ self importCustomersTo: session from: inputStream ] 		raise: Error - MessageNotUnderstood 		withExceptionDo: [ :anException |			anException messageText = (customerImporter invalidCustomerRecordErrorMessage).			self assertCustomersNotImported ]! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/12/2017 23:26'!test08CannotImportAddressRecordWithLessThanSixFields	inputStream := ReadStream on: self invalidTestDataAddressRecordWithLessThanSixFields.		self 		should: [ self importCustomersTo: session from: inputStream ] 		raise: Error - MessageNotUnderstood 		withExceptionDo: [ :anException |			anException messageText = (customerImporter invalidAddressRecordErrorMessage).			self assert: (self numberOfCustomers) equals: 1 ]! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/12/2017 23:01'!test02ImportingCustomersFromFileWithoutCustomerOnFirstLineFails	inputStream := ReadStream on: self invalidTestDataNoCustomerOnFirstLine.		self 		should: [ self importCustomersTo: session from: inputStream ] 		raise: Error - MessageNotUnderstood 		withExceptionDo: [ :anException |			anException messageText = (customerImporter addressWithoutCustomerErrorMessage).			self assertCustomersNotImported ]! !!CustomerImporterTest methodsFor: 'tests' stamp: 'GustavoJuanCairo 11/12/2017 23:09'!test03ImportingCustomersFromFileWithNonexistentSingleCharacterLineDescriptorFails	inputStream := ReadStream on: self invalidTestDataNonexistentLineDescriptor.		self 		should: [ self importCustomersTo: session from: inputStream ] 		raise: Error - MessageNotUnderstood 		withExceptionDo: [ :anException |			anException messageText = (customerImporter invalidRecordDescriptorErrorMessage).			self assertCustomersNotImported ]! !